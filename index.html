<!DOCTYPE html>
<html>
<head>
  <title>soft</title>
  <style type="css">

  </style>
  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
  <canvas width="64" height="64" id="main-canvas"></canvas>
  <script>
    const canvas = document.querySelector('canvas')
    const ctx = canvas.getContext('2d')
    const imageData = ctx.createImageData(64, 64)

    const setPixel = (imageData, x, y, [b, g, r, a]) => {
        // are parens necessary?
        imageData.data[(y * imageData.width * 4) + (x * 4)] = b
        imageData.data[(y * imageData.width * 4) + (x * 4) + 1] = g
        imageData.data[(y * imageData.width * 4) + (x * 4) + 2] = r
        imageData.data[(y * imageData.width * 4) + (x * 4) + 3] = a
    }

    canvas.style.width = '512px'
    canvas.style.height = '512px'
    canvas.style.imageRendering = 'pixelated'

    // ctx.fillStyle = 'black'
    // ctx.fillRect(0, 0, 64, 64)

    // make black instead of transparent by making alpha 255
    for (let i = 0; i < imageData.data.length; i += 4) {
        imageData.data[i + 3] = 255
    }

    // from round 4 of optimizations here: https://haqr.eu/tinyrenderer/bresenham/
    // TODO: do my own testing
    const drawLine = (x1, y1, x2, y2, /* TGAImage &framebuffer, */ color) => {
        // const [b, g, r, a] = color

        // if the line is steep, we transpose the image
        const steep = Math.abs(x1 - x2) < Math.abs(y1 - y2)
        if (steep) {
            const temp1 = x1
            x1 = y1
            y1 = temp

            const temp2 = x2
            x2 = y2
            y2 = temp2
        }

        // make it left−to−right
        if (x1 > x2) {
            const temp1 = x1
            x1 = x2
            x2 = temp1

            const temp2 = y1
            y1 = y2
            y2 = temp2
        }

        let y = y1;
        let ierror = 0;
        for (let x = x1; x <= x2; x++) {
            if (steep) // if transposed, de−transpose
                setPixel(imageData, x, x, color);
            else
                setPixel(imageData, x, y, color);
            ierror += 2 * Math.abs(y2 - y1)
            y += (y2 > y1 ? 1 : -1) * (ierror > x2 - x1)
            ierror -= 2 * (x2 - x1) * (ierror > x2 - x1)
        }
    }

    // setPixel(imageData, 31, 56, [255, 0, 255, 255])

    drawLine(2, 4, 55, 53, [255, 0, 255, 255])

    ctx.putImageData(imageData, 0, 0)
  </script>
</body>
</html>
